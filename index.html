<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cart — Interactive</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,Poppins,sans-serif}
body{background:#f6f7fb;color:#222;padding:18px;direction:rtl}
.wrap{max-width:820px;margin:28px auto;background:#fff;border-radius:10px;padding:20px;box-shadow:0 6px 22px rgba(16,24,40,.08)}
h1{font-size:20px;margin-bottom:12px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:right}
.controls{display:flex;gap:10px;justify-content:center;margin-top:16px}
.btn{padding:8px 14px;border-radius:8px;border:none;cursor:pointer}
.btn-red{background:#ef4444;color:#fff}
.btn-green{background:#16a34a;color:#fff}
.info{max-width:760px;margin:14px auto;padding:10px 12px;border-radius:8px;display:none}
.info.ok{background:#d1fae5;color:#065f46}
.info.warn{background:#fff7cd;color:#7c5a00}
.small{font-size:13px;color:#666;margin-top:8px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <h1>عربة التسوق — عرض تفاعلي</h1>

  <table id="cart-table">
    <tr><th>المنتج</th><th>السعر</th></tr>
  </table>

  <p id="total" style="text-align:left;font-weight:600;margin-top:8px"></p>

  <div class="controls">
    <button class="btn btn-red" id="clearBtn">مسح العربة محلياً</button>
    <button class="btn btn-green" id="checkoutBtn">Checkout (Demo)</button>
  </div>

  <div id="infoBox" class="info"></div>
</div>

<script>
const CART_KEY='cart';

function showInfo(msg,ok=true){
  const box=document.getElementById('infoBox');
  box.style.display='block';
  box.className='info '+(ok?'ok':'warn');
  box.textContent=msg;
  setTimeout(()=>{box.style.display='none';},6000);
}

function loadCart(){return JSON.parse(localStorage.getItem(CART_KEY)||'[]');}
function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c));}

function renderCart(){
  const table=document.getElementById('cart-table');
  table.querySelectorAll('tr.item-row').forEach(r=>r.remove());
  let total=0;
  loadCart().forEach(it=>{
    const tr=document.createElement('tr');
    tr.className='item-row';
    tr.innerHTML=`<td>${it.name}</td><td>$${Number(it.price).toFixed(2)}</td>`;
    table.appendChild(tr);
    total+=Number(it.price);
  });
  document.getElementById('total').textContent=`Total: $${total.toFixed(2)}`;
  return total;
}

document.getElementById('clearBtn').addEventListener('click',()=>{
  localStorage.removeItem(CART_KEY);
  showInfo('تم مسح العربة محلياً.',true);
  renderCart();
});

document.getElementById('checkoutBtn').addEventListener('click',()=>{
  const cart=loadCart();
  if(!cart.length){showInfo('العربة فارغة.',false); return;}
  const total=cart.reduce((s,it)=>s+Number(it.price||0),0);
  const payload={items:cart,total,note:'client-side payment attempt'};
  // إرسال POST للـ Burp
  fetch('https://tayseer2005.github.io/web-sec1/',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  }).catch(()=>{});
  showInfo('تم إرسال طلب الدفع للـ Burp. يمكنك تعديل JSON.',true);
});

renderCart();
</script>
</body>
</html>
